import{d as yt,r as g,C as kt,o as wt,J as St,a as Ct,b as o,e as t,g as h,p as Tt,x as Ft,E as It,t as a,u as M,n as E,F as it,h as nt,f as Mt,i}from"./index-CulLQ6wY.js";import{u as Et}from"./sessions-YxWAsAt5.js";import"./client-wxXmKtvP.js";import"./index-B9ygI19o.js";class Lt{constructor(l=0,c="default"){this.estimatedCost=0,this.lastUpdateTime=Date.now(),this.tokensPerSecond=0,this.processVariance=.001,this.measurementVariance=.01,this.estimationError=1,this.MODEL_RATES={"claude-3-5-sonnet-20241022":{input:.003,output:.015},"claude-3-opus-20240229":{input:.015,output:.075},"claude-3-haiku-20240307":{input:25e-5,output:.00125},default:{input:.003,output:.015}},this.currentModel="default",this.isThinking=!1,this.estimatedCost=l,this.currentModel=c}updateMeasurement(l){const c=this.estimationError/(this.estimationError+this.measurementVariance);this.estimatedCost=this.estimatedCost+c*(l-this.estimatedCost),this.estimationError=(1-c)*this.estimationError;const n=Date.now();(n-this.lastUpdateTime)/1e3>0&&l>this.estimatedCost,this.lastUpdateTime=n}predict(l){if(this.isThinking)return this.estimatedCost;const n=(this.MODEL_RATES[this.currentModel]||this.MODEL_RATES.default).output/1e3*30;return this.estimatedCost+=n*l,this.estimationError+=this.processVariance*l,this.estimatedCost}setThinking(l){this.isThinking=l}setModel(l){this.currentModel=l}getEstimate(){return this.estimatedCost}}class At{constructor(l){this.queue=[],this.currentText="",this.targetBufferLength=50,this.baseSpeed=30,this.lastFrameTime=0,this.accumulator=0,this.animationFrameId=null,this.loop=()=>{if(this.queue.length===0){this.animationFrameId=null;return}const c=performance.now(),n=(c-this.lastFrameTime)/1e3;this.lastFrameTime=c;const p=Math.max(.5,this.queue.length/this.targetBufferLength),d=this.baseSpeed*p*2;this.accumulator+=d*n;let m=Math.floor(this.accumulator);if(m>0){m=Math.min(m,this.queue.length);const r=this.queue.splice(0,m).join("");this.currentText+=r,this.onUpdate(this.currentText),this.accumulator-=m}this.animationFrameId=requestAnimationFrame(this.loop)},this.onUpdate=l}push(l){this.queue.push(...l.split("")),this.animationFrameId||this.start()}start(){this.lastFrameTime=performance.now(),this.loop()}reset(){this.queue=[],this.currentText="",this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}getCurrentText(){return this.currentText}flush(){if(this.queue.length>0){const l=this.queue.join("");this.currentText+=l,this.queue=[],this.onUpdate(this.currentText)}}}const Dt={class:"container mx-auto px-4 py-8"},Rt={key:0,class:"max-w-6xl mx-auto"},qt={class:"mb-6"},$t={class:"card mb-6"},Nt={class:"flex items-start justify-between mb-4"},jt={class:"flex items-center gap-3"},Ut={class:"text-3xl font-bold"},Vt={key:0,class:"w-3 h-3 bg-green-500 rounded-full animate-pulse",title:"WebSocket Connected"},Wt={key:1,class:"w-3 h-3 bg-red-500 rounded-full",title:"WebSocket Disconnected"},Bt={class:"text-gray-500 mt-1"},Ot={class:"flex gap-3 mb-4"},Kt=["disabled"],Pt={key:0},Jt={key:1},Gt=["disabled"],zt={key:0},Yt={key:1},Ht=["disabled"],Qt={key:0},Xt={key:1},Zt=["disabled"],ts={key:0},ss={key:1},es=["disabled"],os={key:0},is={key:1},ns=["disabled"],as={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},ls={class:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm"},rs={class:"ml-2 font-medium"},ds={key:0},us={class:"ml-2 font-medium"},cs={key:1},ps={class:"ml-2 font-medium"},ms={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},hs={class:"font-medium"},vs={key:0},xs={class:"font-medium"},_s={class:"font-medium text-lg"},bs={class:"font-medium text-lg"},fs={class:"card mb-6"},gs={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ys={class:"bg-blue-50 p-4 rounded-lg"},ks={class:"text-2xl font-bold text-blue-900"},ws={class:"text-xs text-blue-500 mt-1"},Ss={class:"bg-purple-50 p-4 rounded-lg"},Cs={class:"text-2xl font-bold text-purple-900"},Ts={class:"text-xs text-purple-500 mt-1"},Fs={class:"bg-green-50 p-4 rounded-lg"},Is={class:"text-2xl font-bold text-green-900"},Ms={class:"whitespace-pre-wrap h-64 overflow-y-auto text-sm"},Es={key:0,class:"card mb-6"},Ls={class:"grid grid-cols-2 md:grid-cols-4 gap-6"},As={class:"text-2xl font-bold"},Ds={class:"text-2xl font-bold"},Rs={class:"text-2xl font-bold"},qs={class:"card"},$s={class:"flex items-center justify-between mb-4"},Ns={class:"flex gap-2 items-center"},js={key:0,class:"text-xs text-green-600 font-medium"},Us={key:1,class:"text-xs text-red-600 font-medium"},Vs={key:0,class:"space-y-2 max-h-96 overflow-y-auto"},Ws={class:"flex items-start justify-between"},Bs={class:"flex-1"},Os={class:"flex items-center gap-2"},Ks={class:"font-medium"},Ps={key:0,class:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded"},Js={key:1,class:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded"},Gs={key:2,class:"text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded"},zs={class:"text-sm text-gray-500 mt-1"},Ys={key:0,class:"mt-2"},Hs={class:"bg-white bg-opacity-50 p-2 rounded text-sm border border-purple-200"},Qs={class:"cursor-pointer font-medium text-purple-900 select-none"},Xs={class:"mt-2 space-y-2 pl-2"},Zs={class:"flex justify-between text-purple-700 mb-1"},te={class:"font-bold"},se={class:"whitespace-pre-wrap font-mono text-gray-600"},ee={key:1,class:"mt-2"},oe={class:"bg-white bg-opacity-50 p-3 rounded text-sm border border-blue-200"},ie={class:"flex items-center gap-2 mb-2"},ne={class:"font-bold text-blue-800"},ae={class:"bg-gray-900 text-gray-300 p-2 rounded font-mono text-xs overflow-x-auto"},le={key:2,class:"text-xs text-gray-600 mt-2 overflow-x-auto bg-gray-50 p-2 rounded"},re={key:1,class:"text-center py-8 text-gray-500"},de={key:1,class:"text-center py-12"},he=yt({__name:"SessionDetail",setup(L){const l=St(),c=Et(),n=g(null),p=g(null),d=g(null),m=g([]),r=g(!1),T=g(0),A=g(""),w=new Lt,S=new At(s=>{A.value=s});let F=null;const{isConnected:D,subscribe:at,unsubscribe:lt}=kt({url:"/ws",onMessage:s=>{mt(s)},onConnect:()=>{console.log("WebSocket connected, subscribing to session");const s=l.params.id;at(s)}});wt(async()=>{var x;const s=l.params.id;await y(s),await rt(s),await k(s),(x=n.value)!=null&&x.cost_usd&&(w.updateMeasurement(n.value.cost_usd),T.value=n.value.cost_usd);let e=performance.now();const v=()=>{const _=performance.now(),b=(_-e)/1e3;e=_,T.value=w.predict(b),F=requestAnimationFrame(v)};v()}),Ct(()=>{const s=l.params.id;lt(s),F&&cancelAnimationFrame(F),S.reset()});async function y(s){n.value=await c.getSession(s)}async function rt(s){try{p.value=await c.getSessionMetrics(s)}catch{console.error("Failed to load metrics")}}async function k(s){try{d.value=await c.getSessionStatus(s)}catch{console.error("Failed to load live status")}}async function dt(){r.value=!0;try{const s=l.params.id;await c.startSession(s),await y(s),await k(s)}catch(s){console.error("Failed to start session:",s),alert("Failed to start session")}finally{r.value=!1}}async function ut(){r.value=!0;try{const s=l.params.id;await c.stopSession(s),await y(s),await k(s)}catch(s){console.error("Failed to stop session:",s),alert("Failed to stop session")}finally{r.value=!1}}async function ct(){if(confirm("Are you sure you want to restart this session?")){r.value=!0;try{const s=l.params.id,e=await c.restartSession(s);e.newSessionId&&e.newSessionId!==s&&alert(`Session restarted with new ID: ${e.newSessionId}`),await y(s),await k(s)}catch(s){console.error("Failed to restart session:",s),alert("Failed to restart session")}finally{r.value=!1}}}async function pt(){if(confirm("Create a new session with the same configuration?")){r.value=!0;try{const s=l.params.id,e=await c.cloneSession(s);e.newSessionId&&alert(`Session cloned! New ID: ${e.newSessionId}`)}catch(s){console.error("Failed to clone session:",s),alert("Failed to clone session")}finally{r.value=!1}}}function mt(s){var e,v,x,_,b;if(console.log("WebSocket message:",s),m.value.unshift(s),m.value.length>100&&(m.value=m.value.slice(0,100)),s.type==="session:launched"||s.type==="session:exit"||s.type==="session:stalled"){const f=l.params.id;y(f),k(f)}if((e=s.data)!=null&&e.usage||(v=s.data)!=null&&v.tokens){const f=l.params.id;k(f)}(x=s.data)!=null&&x.cost_usd&&w.updateMeasurement(s.data.cost_usd),s.type==="stdout"&&((_=s.data)!=null&&_.text)?S.push(s.data.text):s.type==="session:output"&&((b=s.data)!=null&&b.message)&&S.push(s.data.message),s.type==="session:thinking"?w.setThinking(!0):(s.type==="session:generating"||s.type==="stdout"||s.type==="session:output")&&w.setThinking(!1)}function ht(){m.value=[]}function vt(){S.flush()}function C(s){return new Date(s).toLocaleString()}function xt(s){if(s<60)return`${Math.round(s)}s`;const e=Math.floor(s/60),v=Math.round(s%60);return`${e}m ${v}s`}function _t(s){return{completed:"badge-success",active:"badge-info",pending:"badge-warning",failed:"badge-error",stalled:"badge-warning"}[s]||"badge-info"}function bt(s){return s.includes("error")||s.includes("failed")?"bg-red-50 border-red-500":s.includes("stalled")?"bg-yellow-50 border-yellow-500":s.includes("launched")||s.includes("restarted")?"bg-green-50 border-green-500":s.includes("tool_use")?"bg-blue-50 border-blue-500":s==="system_context"?"bg-purple-50 border-purple-500":"bg-gray-50 border-gray-300"}return(s,e)=>{var x,_,b,f,R,q,$,N,j,U,V,W,B,O,K,P,J,G,z,Y,H,Q,X;const v=It("router-link");return i(),o("div",Dt,[n.value?(i(),o("div",Rt,[t("div",qt,[Tt(v,{to:"/sessions",class:"text-primary-600 hover:text-primary-700 text-sm"},{default:Ft(()=>[...e[2]||(e[2]=[Mt(" ‚Üê Back to Sessions ",-1)])]),_:1})]),t("div",$t,[t("div",Nt,[t("div",null,[t("div",jt,[t("h1",Ut,a(n.value.workflow_name),1),M(D)?(i(),o("span",Vt)):(i(),o("span",Wt))]),t("p",Bt,"Session ID: "+a(n.value.id),1)]),t("span",{class:E(["badge text-lg px-4 py-2",_t(((_=(x=d.value)==null?void 0:x.session)==null?void 0:_.status)||n.value.status)])},a(((f=(b=d.value)==null?void 0:b.session)==null?void 0:f.status)||n.value.status),3)]),t("div",Ot,[n.value.status==="pending"?(i(),o("button",{key:0,onClick:dt,disabled:r.value,class:"btn btn-primary"},[r.value?(i(),o("span",Jt,"Starting...")):(i(),o("span",Pt,"‚ñ∂Ô∏è Start Session"))],8,Kt)):h("",!0),n.value.status==="active"||(q=(R=d.value)==null?void 0:R.live)!=null&&q.isActive?(i(),o("button",{key:1,onClick:ut,disabled:r.value,class:"btn btn-error"},[r.value?(i(),o("span",Yt,"Stopping...")):(i(),o("span",zt,"‚èπÔ∏è Stop Session"))],8,Gt)):h("",!0),["active","stalled"].includes(n.value.status)||(N=($=d.value)==null?void 0:$.live)!=null&&N.isActive?(i(),o("button",{key:2,onClick:e[0]||(e[0]=(...u)=>s.handleKick&&s.handleKick(...u)),disabled:r.value,class:"btn btn-warning",title:"Force interrupt (SIGINT)"},[r.value?(i(),o("span",Xt,"Kicking...")):(i(),o("span",Qt,"ü•æ Kick"))],8,Ht)):h("",!0),["active","stalled","failed"].includes(n.value.status)?(i(),o("button",{key:3,onClick:ct,disabled:r.value,class:"btn btn-warning"},[r.value?(i(),o("span",ss,"Restarting...")):(i(),o("span",ts,"üîÑ Restart Session"))],8,Zt)):h("",!0),t("button",{onClick:pt,disabled:r.value,class:"btn btn-primary",title:"Create a new session with same configuration"},[r.value?(i(),o("span",is,"Cloning...")):(i(),o("span",os,"üëØ Clone Session"))],8,es),t("button",{onClick:e[1]||(e[1]=u=>y(M(l).params.id)),class:"btn btn-secondary",disabled:r.value}," üîÉ Refresh ",8,ns)]),(j=d.value)!=null&&j.live?(i(),o("div",as,[e[6]||(e[6]=t("h3",{class:"font-semibold text-sm text-blue-900 mb-2"},"Live Status",-1)),t("div",ls,[t("div",null,[e[3]||(e[3]=t("span",{class:"text-blue-600"},"Active:",-1)),t("span",rs,a(d.value.live.isActive?"‚úÖ Yes":"‚ùå No"),1)]),d.value.live.lastActivity?(i(),o("div",ds,[e[4]||(e[4]=t("span",{class:"text-blue-600"},"Last Activity:",-1)),t("span",us,a(d.value.live.timeSinceActivity)+"s ago",1)])):h("",!0),d.value.live.retryCount>0?(i(),o("div",cs,[e[5]||(e[5]=t("span",{class:"text-blue-600"},"Retries:",-1)),t("span",ps,a(d.value.live.retryCount),1)])):h("",!0)])])):h("",!0),t("div",ms,[t("div",null,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-500"},"Started",-1)),t("div",hs,a(C(n.value.started_at)),1)]),n.value.completed_at?(i(),o("div",vs,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-500"},"Completed",-1)),t("div",xs,a(C(n.value.completed_at)),1)])):h("",!0),t("div",null,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-500"},"Cost",-1)),t("div",_s," $"+a((((V=(U=d.value)==null?void 0:U.session)==null?void 0:V.cost_usd)||n.value.cost_usd||0).toFixed(4)),1)]),t("div",null,[e[10]||(e[10]=t("div",{class:"text-sm text-gray-500"},"Total Tokens",-1)),t("div",bs,a(((((B=(W=d.value)==null?void 0:W.session)==null?void 0:B.input_tokens)||n.value.input_tokens||0)+(((K=(O=d.value)==null?void 0:O.session)==null?void 0:K.output_tokens)||n.value.output_tokens||0)).toLocaleString()),1)])])]),t("div",fs,[e[15]||(e[15]=t("h2",{class:"text-xl font-bold mb-4"},"Token Usage",-1)),t("div",gs,[t("div",ys,[e[11]||(e[11]=t("div",{class:"text-sm text-blue-600 mb-1"},"Input Tokens",-1)),t("div",ks,a((((J=(P=d.value)==null?void 0:P.session)==null?void 0:J.input_tokens)||n.value.input_tokens||0).toLocaleString()),1),t("div",ws," $"+a(((((z=(G=d.value)==null?void 0:G.session)==null?void 0:z.input_tokens)||n.value.input_tokens||0)/1e6*3).toFixed(4)),1)]),t("div",Ss,[e[12]||(e[12]=t("div",{class:"text-sm text-purple-600 mb-1"},"Output Tokens",-1)),t("div",Cs,a((((H=(Y=d.value)==null?void 0:Y.session)==null?void 0:H.output_tokens)||n.value.output_tokens||0).toLocaleString()),1),t("div",Ts," $"+a(((((X=(Q=d.value)==null?void 0:Q.session)==null?void 0:X.output_tokens)||n.value.output_tokens||0)/1e6*15).toFixed(4)),1)]),t("div",Fs,[e[13]||(e[13]=t("div",{class:"text-sm text-green-600 mb-1"},"Total Cost",-1)),t("div",Is," $"+a(T.value.toFixed(4)),1),e[14]||(e[14]=t("div",{class:"text-xs text-green-500 mt-1"}," Real-time Estimate (Kalman Filter) ",-1))])])]),t("div",{class:"card mb-6 bg-gray-900 text-green-400 font-mono cursor-pointer hover:bg-gray-800 transition-colors",onClick:vt,title:"Click to skip animation"},[e[16]||(e[16]=t("div",{class:"flex justify-between items-center mb-2 border-b border-gray-700 pb-2"},[t("h2",{class:"text-lg font-bold"},"Live Terminal"),t("span",{class:"text-xs text-gray-500"},"Buffered Stream (Click to Skip)")],-1)),t("pre",Ms,a(A.value||"> Waiting for output..."),1)]),p.value?(i(),o("div",Es,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold mb-4"},"Session Metrics",-1)),t("div",Ls,[t("div",null,[e[17]||(e[17]=t("div",{class:"text-sm text-gray-500"},"Duration",-1)),t("div",As,a(xt(p.value.duration_seconds)),1)]),t("div",null,[e[18]||(e[18]=t("div",{class:"text-sm text-gray-500"},"Tool Calls",-1)),t("div",Ds,a(p.value.tool_calls||0),1)]),t("div",null,[e[19]||(e[19]=t("div",{class:"text-sm text-gray-500"},"Errors",-1)),t("div",{class:E(["text-2xl font-bold",p.value.errors>0?"text-red-600":"text-green-600"])},a(p.value.errors||0),3)]),t("div",null,[e[20]||(e[20]=t("div",{class:"text-sm text-gray-500"},"Avg Cost/1K Tokens",-1)),t("div",Rs,a(p.value.cost_usd&&p.value.total_tokens?`$${(p.value.cost_usd/p.value.total_tokens*1e3).toFixed(3)}`:"N/A"),1)])])])):h("",!0),t("div",qs,[t("div",$s,[e[22]||(e[22]=t("h2",{class:"text-xl font-bold"},"Live Events",-1)),t("div",Ns,[M(D)?(i(),o("span",js,"‚óè Live")):(i(),o("span",Us,"‚óè Disconnected")),t("button",{onClick:ht,class:"btn btn-secondary text-sm"}," Clear ")])]),m.value.length>0?(i(),o("div",Vs,[(i(!0),o(it,null,nt(m.value,(u,ft)=>{var Z,tt,st,et;return i(),o("div",{key:ft,class:E(["p-4 rounded-lg border-l-4",bt(u.type)])},[t("div",Ws,[t("div",Bs,[t("div",Os,[t("span",Ks,a(u.type),1),u.type.includes("stalled")?(i(),o("span",Ps," ‚ö†Ô∏è Stalled ")):h("",!0),u.type.includes("restarted")?(i(),o("span",Js," üîÑ Restarted ")):h("",!0),u.type==="system_context"?(i(),o("span",Gs," üß† Context Injected ")):h("",!0)]),t("div",zs,a(C(u.timestamp)),1),u.type==="system_context"?(i(),o("div",Ys,[t("details",Hs,[t("summary",Qs," Injected "+a(((Z=u.data)==null?void 0:Z.count)||0)+" memories ",1),t("div",Xs,[(i(!0),o(it,null,nt((tt=u.data)==null?void 0:tt.memories,(I,gt)=>{var ot;return i(),o("div",{key:gt,class:"text-xs text-gray-700 border-l-2 border-purple-300 pl-2 bg-white p-2 rounded shadow-sm"},[t("div",Zs,[t("span",te,a(C(I.timestamp)),1),t("span",null,"Score: "+a((ot=I.score)==null?void 0:ot.toFixed(2)),1)]),t("div",se,a(I.content),1)])}),128))])])])):u.type==="session:tool_use"||u.type==="tool_use"?(i(),o("div",ee,[t("div",oe,[t("div",ie,[t("span",ne,"üõ†Ô∏è "+a((st=u.data)==null?void 0:st.tool),1),e[23]||(e[23]=t("span",{class:"text-xs text-blue-600 bg-blue-100 px-2 py-0.5 rounded-full"},"Tool Call",-1))]),t("div",ae,a(JSON.stringify((et=u.data)==null?void 0:et.input,null,2)),1)])])):u.data?(i(),o("pre",le,a(JSON.stringify(u.data,null,2)),1)):h("",!0)])])],2)}),128))])):(i(),o("div",re,[...e[24]||(e[24]=[t("p",null,"Waiting for events...",-1),t("p",{class:"text-sm mt-2"},"Real-time events will appear here when the session is active",-1)])]))])])):(i(),o("div",de,[...e[25]||(e[25]=[t("p",{class:"text-gray-500"},"Loading session...",-1)])]))])}}});export{he as default};
